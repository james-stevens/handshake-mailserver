<html>
<head>
	<title>Python Registrar</title>
	<meta charSet="utf-8"/>
	<script src="/theme.js"></script>
	<script src="/punycode.js"></script>
	<script src="/lib.js"></script>
</head>
<style type='text/css'>.msgPop { visibility: hidden;}</style>
<script language="Javascript">

var debugAPI = false;

const is_hex = /^[0-9a-fA-F]+$/;
const pre_get_elm = [
	"topMsg","myMsgPop","errorSpan","emailIcon","ordersIcon", "userInfo","default",
	"userSpace","output","topSpan","businessName","messagesIcon"
	];

elm = {};
gbl = {
	"theme": window.localStorage.theme,

	tick: "&#x2611;",
	cross: "&#x2612;",
	timer: "&#x23f3;",
	cut: "&#x2702;",
	waste: "&#x1F5D1;",
	warn: "&#x26a0;",
	page: "&#x1F5CE;",
	nsec: "&#x1F512;",
	nsec3: "&#x1F510;",
	clip: "&#x1F4CE;",
	cart: "&#128722;",
	email: "&#128231;",
	copy: "&#x2398",
	credit: "&#x1F4B3;",
	lock: "&#x1F512;",
	unlock: "&#x1F513;",
	thumb: "&#x1F44d;",
	loading: "Loading ... &#x23f3;",

	gap: "<div style='height: 7px;'></div>",
	settings_spacer: "<tr><td><div style='height: 70px;'></div></td></tr>",

	def_max_checks: 5
	};

ctx = {};
if (window.localStorage.session) ctx.session = window.localStorage.session;

if ((gbl.theme == null)||(!(gbl.theme in theme_colours))) {
	gbl.theme="default";
	window.localStorage.setItem("theme",gbl.theme);
	}

changeTheme(gbl.theme);

if (window.location.pathname!="/") {
	ctx.router_path = window.location.pathname;
	window.location = window.location.origin;
	}


gbl.head = document.head || document.getElementsByTagName('head')[0];



// This one function is danallison/downloadString.js
// https://gist.github.com/danallison/3ec9d5314788b337b682
function downloadFile(text, fileType, fileName) {
    var blob = new Blob([text], { type: fileType });

    var a = document.createElement('a');
    a.download = fileName;
    a.href = URL.createObjectURL(blob);
    a.dataset.downloadurl = [fileType, a.download, a.href].join(':');
    a.style.display = "none";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    setTimeout(() => URL.revokeObjectURL(a.href), 1500);
}
// end of -> danallison/downloadString.js



function keyEsc(e) {
    if (e.key == "Escape") {
    	hideAllPopUp();
    	unerrMsg();
    	}
}


function hideAllPopUp()
{
	hidePopUp();
	["loginPopup","registerPopup","themePopup"].forEach(item => {
		let popup = document.getElementById(item);
		popup.classList.remove("show")
		});
}


function clr_lazy_hide()
{
	if (!ctx.popup) return;
	if (ctx.popup.timer) clearTimeout(ctx.popup.timer);
	delete ctx.popup;
}


function togglePopUp(name,tmout)
{
	if ("popup" in ctx) {
		let save_name = ctx.popup.name;
		hidePopUp();
		if (save_name==name) { unerrMsg(); return; }
		}

	let popup = document.getElementById(name);
	if (popup) popup.classList.toggle("show");

	let hide_now = null;
	if (tmout) {
		hide_now = setTimeout(hidePopUp,tmout);
		}

	ctx.popup = { "timer": hide_now, "name": name }

	let e = null;
	if (name=="loginPopup") e = document.formLogin.email;
	if (name=="registerPopup") e = document.formRegister.user;
	if (name=="AddNSPopup") e = document.getElementById("inputNS");
	if (name=="AddDSPopup") e = document.getElementById("ds_keyTag");
	if (name=="AddRRwin") e = document.getElementById("rr_name");
	if (name=="AddTLSAwin") e = document.getElementById("tlsa_o");
	if (name=="emojiPopup") e = document.getElementById("emojiSearch");
	if (name=="TopUpAcct") e = document.getElementById("top_up_amount");
	if (e) {
		e.focus(); e.select();
		if (name=="emojiPopup") show_emoji_search();
		}
	return false;
}



function hidePopUp()
{
	if (!("popup" in ctx)) return;
	let popup = document.getElementById(ctx.popup.name);
	if (popup) popup.classList.remove("show")
	clr_lazy_hide();
}



function do_theme_change(value)
{
	clr_lazy_hide();
	if (value in theme_colours) changeTheme(value);
	let popup = document.getElementById("themePopup");
	popup.classList.remove("show")
}


function toggleLogin() { togglePopUp("loginPopup",0); }
function toggleRegister() { togglePopUp("registerPopup",0); }
function toggleTheme() { togglePopUp("themePopup",5000); }



function show_one_space(name)
{
	hidePopUp();
	for (let item of ["userSpace","default"]) {
		if (item != name) elm[item].style.display = "none";
		};
	elm[name].style.display = "block";
}

function size_one_space() { setTimeout(do_size_one_space,250); }
function do_size_one_space()
{
	let sz = 0;
	for (let item of ["userSpace","default"])
		if (elm[item].style.display != "none") sz = elm[item].clientHeight+200;
    if (sz < window.innerHeight) sz = window.innerHeight;
    document.body.style.height = sz;
}


function loggedIn()
{
	let e = document.getElementById("noLoginBtns");
	e.style.display = "none";
	e = document.getElementById("isLoggedIn");
	e.style.display = "block";
	if (elm.userSpace.style.display == "block") go_welcome_page(true);
	user_info();
}


function go_welcome_page(with_push)
{
	if (with_push) push_hist("goSearch");
	hideAllPopUp();
	show_one_space("default");
	size_one_space();
}


function user_info()
{
	if ((ctx.user)&&(ctx.user.user)) {
		elm.userInfo.innerHTML = `Logged in as: <b>${ctx.user.user}</b>`;
		}
}




function send_confirm_email()
{
	callApi("email/sendverify",(ok,reply) => {
		if (!ok) return def_errMsg("Failed to send verification email",reply,"errorSpan");
		elm.userSpace.innerHTML = "<h2>"+gbl.tick+"&nbsp;Verification email sent</h2>";
		});
}



function doRegister()
{
	function regErr(err)
	{
		errMsg(err,"registerPopup");
		clr_lazy_hide();
		item.focus();
	}

	let f = document.formRegister;

	if (f.password.value != f.confirm.value) return regErr("Passwords do not match");
	if (!valid_email.test(f.email.value)) return regErr("Invalid email address");
	if (!fqdnCheck.test(f.name.value)) return regErr("Invalid domain name");

	let data = {
		"user":f.user.value,
		"email":f.email.value,
		"password":f.password.value,
		"confirm":f.confirm.value
		};

	callApi("users/register",(ret,reply) => {
		if (!ret) return def_errMsg("Error in registration",reply,f);
		hidePopUp();
		catch_user_data(reply);
		loggedIn();

		f.email.value = "";
		f.password.value = "";
		f.confirm.value = "";
		f.user.value = "";

		}, { json: data });
}


function doLogin()
{
	function regErr(err,item)
	{
		errMsg(err,"loginPopup");
		clr_lazy_hide();
		item.focus();
		return false;
	}

	let f = document.formLogin;
	if (!fqdnCheck.test(f.user.value)) return regErr("Invalid login name",f.user);

	let data = { "user":f.user.value, "password":f.password.value };

	callApi("users/login",(ret,reply) => {
		if (!ret) {
			let msg="Error logging in";
			if ("error" in reply) msg = reply["error"];
			return regErr(msg,f.email);
			}
		hidePopUp();
		catch_user_data(reply);
		loggedIn();

		f.user.value = "";
		f.password.value = "";

		}, { json: data });

	return false;
}



function doLogOut()
{
	ctx = {};
	callApi("users/logout",(ret,reply) => {});
	show_one_space("default");
	loggedOut();
}



function loggedOut()
{
	let e = document.getElementById("noLoginBtns");
	e.style.display = "block";
	e = document.getElementById("isLoggedIn");
	e.style.display = "none";
	elm.userInfo.innerHTML = "";

	elm.emailIcon.style.display="none";
	elm.ordersIcon.style.display="none";

	go_welcome_page(true);
}



function history_back(event)
{
	if (!event.state) return;

	let router = {
		"resend_password": resend_password,
		"basketCheckout": basketCheckout,
		"payment_methods": payment_methods,
		"domain_dns": go_domain_dns,
		"domain_transfer_options": go_domain_transfer_options,
		"domain_settings": go_domain_settings,
		"show_one_domain": go_show_one_domain,
		"user_statement": go_user_statement,
		"user_settings": user_settings,
		"myAccount": myAccount,
		"myDomains": myDomains,
		"myAboutMe": select_about_me,
		"request_transfer": request_transfer,
		"go_welcome_page": go_welcome_page,
		"viewMessages": viewMessages,
		"welcome": go_welcome
		};

	let param_value = null;
	let func_name = event.state;
	if (func_name.indexOf("/")>=0) {
		let parts = event.state.split("/");
		func_name = parts[0];
		param_value = parts.slice(1);
		}

	if (func_name in router) router[func_name](false,param_value);
	return true;
}



function bodyLoaded()
{
	window.addEventListener('popstate',history_back);
	let e = document.getElementById("themePopup");
	e.innerHTML = make_theme_popup();
	go_welcome(true);
}



function push_hist(data)
{
	window.history.pushState(data,"",policy("website_name"));
}


function go_welcome(with_push)
{
	pre_get_elm.forEach(i => { elm[i] = document.getElementById(i); } );
	show_one_space("default");
	let mainDiv = document.getElementById("allBottom");
	mainDiv.onclick = function (e) { if (e.target !== this) return; hidePopUp(); }
	let srchDiv = document.getElementById("default");
	srchDiv.onclick = function (e) { if (e.target !== this) return; hidePopUp(); }

	callApi("hello",(ok,reply) => {

        if (ctx.session) {
            callApi("users/details",(ok,reply) => {
                if (ok) {
                    catch_user_data(reply);
                    loggedIn();
                    }
                check_router_path();
                });
            } else { loggedOut(); check_router_path(); }

		});
}



function router_reset_password(params)
{
	if (params[0].length!=30) {
		elm.userSpace.innerHTML = "Invalid reset code";
		show_one_space("userSpace");
		return;
		}

	if (ctx.session) {
		elm.userSpace.innerHTML = "<h2>You are already logged in</h2>";
		show_one_space("userSpace");
		return;
		}

	let x = "";
	x += "<form name=resetPass action=# method=post onSubmit='return do_reset_password();'><table width=75% id='reset_table' align=center border=0>";
	x += "<tr><th colspan=2>Reset your password</th></tr>";
	x += "<tr><td colspan=2>"+gbl.gap+"</td></tr>";
	x += `<input type=hidden name=reset_code value='${params[0]}'>`;
	x += '<tr><td class=formPrompt>&nbsp;Reset PIN Number:&nbsp;</td><td><input onkeyUp="keyEsc(event);" style="width: 100px;" id="reset_pin">&nbsp;</td></tr>';
	x += '<tr><td class=formPrompt>&nbsp;Password:&nbsp;</td><td><input autocomplete="new-password" onkeyUp="keyEsc(event);" style="width: 250px;" type=password id="reset_password">&nbsp;</td></tr>';
	x += '<tr><td class=formPrompt>&nbsp;Confirm:&nbsp;</td><td><input autocomplete="new-password" onkeyUp="keyEsc(event);" style="width: 250px;" type=password id="reset_confirm">&nbsp;</td></tr>';
	x += "<tr><td colspan=2>"+gbl.gap+"</td></tr>";
	x += '<tr><td class=btmBtnBar colspan=2>';
	x += '<span style="width: 75px;" tabindex=0 title="Cancel" class=myBtn onClick="go_welcome_page();">Cancel</span>';
	x += '<input style="width: 110px;" tabindex=0 type=submit title="Reset your password" class=myBtn value="Reset">';
	x += '</td>';
	x += '</tr></form></table>';

	elm.userSpace.innerHTML = x;
	show_one_space("userSpace");
	let e = document.getElementById("reset_pin");
	if (e) e.focus();
}



function do_reset_password()
{
	send_json = {
		"pin": document.resetPass.reset_pin.value,
		"code": document.resetPass.reset_code.value,
		"password": document.resetPass.reset_password.value,
		"confirm": document.resetPass.reset_confirm.value
		};

	if (send_json.code.length != 30) { go_welcome_page(); return false; }
	if (send_json.pin.length != 4) {
		errMsg("Invalid PIN Number");
		document.resetPass.reset_pin.focus();
		document.resetPass.reset_pin.select();
		return false;
		}

	if ((!send_json.password.length)||(!send_json.confirm.length)||(send_json.password != send_json.confirm)) {
		errMsg("Password and confirm do not match or are invalid","reset_table");
		document.resetPass.reset_password.focus();
		document.resetPass.reset_password.select();
		return false;
		}

	callApi("password/reset",(ok,reply) => {
		if (!ok) def_errMsg("Password reset failed",reply,"reset_table");
		else elm.userSpace.innerHTML = "<h2>Your password has been reset</h2>";
		}, { json: send_json });

	return false;
}



function check_router_path()
{
	if (!ctx.router_path) return;
	delete ctx.router_path

	let router = {
		"pass_reset": router_reset_password,
		};

	let router_path = window.localStorage.router_path;
	window.localStorage.removeItem("router_path");

	let path_parts = router_path.split("/").slice(1);
	if (!(path_parts[0] in router)) return;

	let fn_call = router[path_parts[0]];
	fn_call(path_parts.slice(1));
}



function catch_user_data(reply)
{
	["user"].forEach((item) => {
		if (item in reply) ctx[item] = reply[item];
		})
}



function postUserPassword()
{
	let f = document.editUserPassword;
	function regErr(err,item) { errMsg(err,"editUserPassword"); item.focus(); return false; }

	if (f.password.value=="") return regErr("Password missing",f.password);
	if (f.new_password.value=="") return regErr("New password missing",f.new_password);
	if (f.confirm_password.value=="") return regErr("Confirm password missing",f.confirm_password);

	if (f.new_password.value != f.confirm_password.value)
		return regErr("Passwords do not match",f.new_password);

	let data = {
		"password": f.password.value,
		"new_password": f.new_password.value,
		};

	callApi("users/password",(ret,reply) => {
		if (ret) {
			errMsg("Password changed","userInfo");
			user_info();
			elm.userSpace.innerHTML = userDetails();
			size_one_space();
			}
		else {
			if ("error" in reply) msg=reply["error"]; else msg="Failed";
			return regErr(msg);
			}
		}, { json: data });

	return false;
}


function postCloseAccount()
{
	let f = document.editCloseAccount;
	function regErr(err,item) { errMsg(err,"editCloseAccount"); item.focus(); return false; }

	if (f.close_password.value=="") return regErr("Password missing",f.close_password);

	callApi("users/close",(ret,reply) => {
		if (ret) go_welcome_page(true);
		else def_errMsg("failed",reply,"editCloseAccount");
		}, { json: { "password": f.close_password.value }});

	return false;
}

function enable_two_fa() { errMsg(gbl.thumb+"&nbsp;Coming Soon","2fa_section"); } // CODE - Add 2fa features
function disable_two_fa() { errMsg(gbl.thumb+"&nbsp;Coming Soon","2fa_section"); } // CODE - Add 2fa features



function user_settings(with_push)
{
	if (with_push) push_hist("user_settings");
	hidePopUp();
	user_settings_page(user_general_settings);
	size_one_space();
	document.editUserDetails.user_email.focus();
}



function user_settings_page(func)
{
	let x = "<table align=center style='min-width: 75%;' cellspacing=3 cellpadding=0 border=0>";
	x += "<tr><td class=btmBtnBar>";
	x += "<button style='width: 135px;' onClick='user_settings_page(user_general_settings);' class=myBtn>General</button>";
	x += "<button style='width: 135px;' onClick='start_email_blocking();' class=myBtn>Emails</button>";
	x += "</td></tr><tr><td>" + func() + "</td></tr></table>";
	elm.userSpace.innerHTML = x;
}


function user_general_settings()
{
	let x="<table align=center border=0>";
	x += settings_header("Change User Details",true);
	x += "<form name=editUserDetails method=post action=# onSubmit='postUserDetails(); return false;'>";
	x += "<table id=editUserDetails width=100%><colgroup><col width=30%/><col/><col width=10%/></colgroup>";
	x += form_prompt("E-Mail Domain")+`<input style="width: 300px;" id='user_domain' value='${ctx.user.email}'></td></tr>`;
	x += form_prompt("Recovery E-Mail")+`<input style="width: 300px;" id='user_email' value='${ctx.user.name}'></td></tr>`;
    x += form_prompt("Default Auto Renew")+`<select id='default_auto_renew'>`;

    let yes_chk="",no_chk="";
    if (ctx.user.default_auto_renew) yes_chk="selected"; else no_chk="selected";
    x += `<option ${yes_chk} value=1>Yes<option ${no_chk} value=0>No</select></td></tr>`;
	x += "<tr><td colspan=2></td><td align=right><input style='width: 135px;' type=submit class=myBtn value='Change'></td></tr>";
	x += "</table></form></td></tr>";


	x += settings_header("Control Two-Factor Authentication");
	x += "<table width=100%><colgroup><col width=30%/><col/><col width=10%/></colgroup>";
	if (("two_fa" in ctx.user) && (ctx.user.two_fa != null) && (ctx.user.two_fa != "")) {
		x += "<tr><td colspan=2>Disable Google Authenticator two-factor authentication</td></tr>";
		x += "<tr><td colspan=2></td><td id=2fa_section align=right>"+btn("disable_two_fa()","Disable 2FA","Disable Google Authenticator two-factor authentication",100)+"</td></tr>";
		}
	else {
		x += "<tr><td colspan=2>Enable Google Authenticator two-factor authentication</td></tr>";
		x += "<tr><td colspan=2></td><td id=2fa_section align=right>"+btn("enable_two_fa()","Enable 2FA","Enable Google Authenticator two-factor authentication",100)+"</td></tr>";
		}
	x += "</table></form></td></tr>";


	x += settings_header("Change Your Password");
	x += "<form name=editUserPassword method=post action=# onSubmit='postUserPassword(); return false;'>";
	x += "<table id=editUserPassword width=100%><colgroup><col width=30%/><col/><col width=10%/></colgroup>";
	x += form_prompt("Current Password");
	x += `<input style="width: 300px;" autocomplete="current-password" placeholder="Current password" type=password id='password'></td></tr>`;
	x += form_prompt("<b>New</b> Password");
	x += `<input style="width: 300px;" autocomplete="new-password" placeholder="New password" type=password id='new_password'></td></tr>`;
	x += form_prompt("Confirm <b>New</b> Password");
	x += `<input style="width: 300px;" autocomplete="new-password" placeholder="Confirm New Password" type=password id='confirm_password'></td></tr>`;
	x += "<tr><td colspan=2></td><td align=right><input style='width: 135px;' type=submit class=myBtn value='Change'></td></tr>";
	x += "</table></form></td></tr>";


	x += settings_header("Close This Account");
	x += "<form name=editCloseAccount method=post action=# onSubmit='postCloseAccount(); return false;'>";
	x += "<table id=editCloseAccount width=100%><colgroup><col width=30%/><col/><col width=10%/></colgroup>";
	x += "<tr><td colspan=2>To close your account, please enter your current password</td></tr>";
	x += "<tr><td colspan=2>"+gbl.gap+"</td></tr>";
	x += form_prompt("Current Password");
	x += `<input style="width: 300px;" autocomplete="current-password" placeholder="Your current password" type=password id='close_password'></td></tr>`;
	x += "<tr><td colspan=2></td><td align=right><input style='width: 135px;' type=submit class=myBtn value='Close Account'></td></tr>";
	x += "</table></form></td></tr>";

	return x+"</table>";
}



function userDetails()
{
	let x = "<table>"
	for(let i in ctx.user) x += `<tr><td>${i}</td><td>${ctx.user[i]}</td></tr>`;
	return x+"</table>";
}



function myAccount(with_push)
{
	if (with_push) push_hist("myAccount");

	show_one_space("userSpace");
	elm.userSpace.innerHTML = "";
	size_one_space();

	callApi("users/details",(ok,reply) => {
		if (!ok) {
			go_welcome_page(true);
			return def_errMsg("Error in setting your data",reply,"searchEdit");
			}
		catch_user_data(reply);
		user_info();
		elm.userSpace.innerHTML = userDetails();
		size_one_space();
		});
}





function AddkeyDown(event,idx,rrs_id,rec_id) {
	if (event.key=="Escape") return hideAllPopUp();
	if (event.key=="Enter") return process_add_rr(idx,rrs_id,rec_id);
}



function submit_resend()
{
	send_json = {
		"email": document.resendPass.email.value,
		"pin":document.resendPass.pin.value
		};

	if (!valid_email.test(send_json.email)) {
		errMsg("Email address is invalid",'resend_table');
		document.resendPass.email.focus();
		return false;
		}

	callApi("password/request",(ok,reply) => {
		if (!ok) {
			def_errMsg("Reset password request failed",reply,"resend_table");
			return false;
			}

		elm.userSpace.innerHTML = "<h2>Reset request processed</h2><P>"
			+"<center>If a matching account has been found<br>you will receive an email with a reset link<P>"
			+`<P>Don't forget you will need your PIN number<P><h2>${send_json.pin}</h2></center>`;

		},{ json: send_json });

	return false;
}


function resend_password(with_push)
{
	if (with_push) push_hist("resend_password");
	hideAllPopUp()
	pin_code = (Math.trunc(Math.random()*1000000)).toString().slice(-4);
	let x = "<form name=resendPass action=# method=post onSubmit='return submit_resend();'><table width=75% id='resend_table' align=center border=0>";
	x += settings_header("Reset Password",true);
	x += "Enter your email address below and we will email you a link to reset your password</td></tr>";
	x += "<tr><td colspan=2>"+gbl.gap+"</td></tr>";
	x += "<tr><Td style='white-space: normal;'>When you click the password reset link in the email, you will be asked for the PIN number shown below. ";
	x += "You will <B>NOT</b> be able to reset your password without this PIN Number</td></tr>"
	x += "<tr><td colspan=2>"+gbl.gap+"</td></tr>";
	x += `<tr><td><h2>${pin_code}</h2></td></tr>`;
	x += "<tr><td colspan=2>"+gbl.gap+"</td></tr>";
	x += "<tr><td><table width=100%><tr><td class=formPrompt>Your email address:</td>";
	x += `<input type=hidden name=pin value='${pin_code}'>`;
	x += "<td><input autofocus style='width: 350px;' name=email></td></tr>";
	x += "<tr><td colspan=2>"+gbl.gap+"</td></tr>";
	x += "<tr><td class=btmBtnBar colspan=2><input type=submit value='Reset Password' class=myBtn></td></tr>";
	x += "<tr><td colspan=2>"+gbl.gap+"</td></tr>";
	x += "</form></table></td></tr></table>";
	elm.userSpace.innerHTML = x;
	show_one_space("userSpace");
	document.resendPass.email.focus();
	return false;
}



function make_theme_popup()
{
	if ((!theme_colours)||(!Object.keys(theme_colours).length)) {
		let e = document.getElementById("themeButton");
		e.style.display = "none";
		return "";
		}

	let x = '<table style="width: 120px;" border=0 cellspacing=2 cellpadding=5>';
	for(let i in theme_colours)
		if (i != "default") x += `<tr class=dataRow onClick='do_theme_change("${i}");'><td>${pretty_prompt(i)}</td></tr>`;
	x += '</table>';
	return x;
}

</script>
<body onLoad="bodyLoaded();">
<div id="topSpan">
<table border=0 width=100% cellspacing=0 cellpadding=5 style="margin-top: 15px;">
<colgroup><col width=40%/><col width=200px/><col/></colgroup>
<tr>
<td align=left><span id="businessName" class="businessName">Registrar</span></td>
<td rowspan=2 align=center><div style="width: 200px margin:20px; font-size: 20px;" id="topMsg">&nbsp;</div></td>
<td align=right>

<span style="display: none;" id="noLoginBtns">

<div class="popup">
<span style='width: 75px;' tabindex=0 title="Register me" class=myBtn onClick="toggleRegister(); return false;">Register</span>
<span class="popuptext" id="registerPopup">
<form onSubmit='doRegister(); return false;' method=submit action='#' name=formRegister><table>
<tr onClick="toggleRegister();"><Td colspan=2><div style="height: 15px;"></div></td></tr>
	<tr><td class=formPrompt>&nbsp;E-Mail Domain:&nbsp;</td><td><input onkeyUp="keyEsc(event);" style="width: 250px;" name="user">&nbsp;</td></tr>
	<tr><td class=formPrompt>&nbsp;Recovery E-Mail:&nbsp;</td><td><input onkeyUp="keyEsc(event);" style="width: 250px;" name="email">&nbsp;</td></tr>
	<tr><td class=formPrompt>&nbsp;Password:&nbsp;</td><td><input onkeyUp="keyEsc(event);" style="width: 250px;" type=password name="password">&nbsp;</td></tr>
	<tr><td class=formPrompt>&nbsp;Confirm:&nbsp;</td><td><input onkeyUp="keyEsc(event);" style="width: 250px;" type=password name="confirm">&nbsp;</td></tr>
<tr><td colspan=2><div style='height: 7px;'></div></td></tr>
<tr>
	<td class=btmBtnBar colspan=2>
		<span style='width: 75px;' tabindex=0 title="Cancel" class=myBtn onClick="toggleRegister();">Cancel</span>
		<input style='width: 110px;' tabindex=1 type=submit title="Register" class=myBtn value="Register">
	</td>
</tr></form></table>
</span></div>


<div class="popup">
<span style='width: 75px;' tabindex=0 title="Get me logged in" class=myBtn onClick="toggleLogin(); return false;">Login</span>
<span class="popuptext" id="loginPopup">
	<table>
		<form onSubmit='doLogin(); return false;' action="#" method=post name=formLogin>
		<tr onClick="toggleLogin()"><Td colspan=2><div style="height: 15px;"></div></td></tr>
			<tr><td class=formPrompt>&nbsp;E-Mail Domain:&nbsp;</td><td><input onkeyUp="keyEsc(event);" style="width: 250px;" name="user">&nbsp;</td></tr>
			<tr><td class=formPrompt>&nbsp;Password:&nbsp;</td><td><input onkeyUp="keyEsc(event);" style="width: 250px;" type=password name="password">&nbsp;</td></tr>
		<tr><td colspan=2><div style='height: 7px;'></div></td></tr>
		<tr><td align=center colspan=2><a href=# onClick="return resend_password(true);">Forgotton</a> your password</td></tr>
		<tr><td colspan=2><div style='height: 7px;'></div></td></tr>
		<tr>
			<td class=btmBtnBar colspan=2>
				<span style='width: 75px;' tabindex=0 title="Cancel" class=myBtn onClick="toggleLogin()">Cancel</span>
				<input style='width: 110px;' tabindex=0 type=submit title="Login" class=myBtn value="OK">
			</td>
		</tr>
		</form>
	</table>
</span>
</div>
</span>

<span style="display:none;" id="isLoggedIn">
	<span style='width: 75px;' tabindex=0 title="List my domains" id="myDomainsBtn" class=myBtn onClick="myDomains(true); return false;">Domains</span>
	<span style='width: 75px;' tabindex=0 title="My account details" id="myAccountBtn" class=myBtn onClick="myAccount(true); return false;">Account</span>
	<span style='width: 75px;' tabindex=0 title="Log me out" class=myBtn onClick="doLogOut(); return false;">Logout</span>
</span>
</td></tr>
</td>

</tr>

<tr><Td>
<div class="popBelow">
<span style='width: 85px;' id=themeButton tabindex=0 title="Change theme" class=myBtn onClick="toggleTheme();">Theme</span>
<span class="popBelowText" id="themePopup">&nbsp;</span>
</div>
</td>


<td align=right><table width=100% border=0 cellspacing=0 cellpadding=0>
<colgroup><col width=20%/><col width=5%/><col width=5%/><col width=5%/><col width=5%/><col width=60%/></colgroup>
<tr>
<td><span id="errorSpan">&nbsp;</span></td>
<td><span title="You have new messages" id=messagesIcon class=userIcons style="display: none;" onClick="viewMessages(true);">&#x1F514;</span></td>
<td><span title="Please confirm your email address" id=emailIcon class=userIcons style="display: none;" onClick="confirmEmail();">&#128231;</span></td>
<td><span title="You have orders waiting to be paid for" id="ordersIcon" class=userIcons style="display: none;" onClick="orders_icon();">&#x1F4B3;</span></td>
<td align=center>
<span id="basketIcon" style="display: none;" class="popup">
<span class=userIcons title="You have items waiting to checkout" ${style} onClick='togglePopUp("basketPopup",30000);'>&#128722;</span>
<span style="margin-left: -250px;" class="popuptext" id="basketPopup">
</span></span></td><td align=right><span id="userInfo"></span></td></tr></table></td>
</tr></table>
</div>

<div style="height: 100px;">&nbsp;</div>

<div id="allBottom">
	<span class="botSpace" id="default" style="display: none;">Hello</span>
	<span class="botSpace" id="userSpace" style="display: none;"></span>
</div>

<div><table><tr><td><div onClick="unerrMsg();" id=myMsgPop class='msgPop msgPopNo'></div></td></tr></table></div>
</body>
</html>
